//console.log("load message");
window.scrollBy(0, 200);

var field_id_name = "#chat-field";

  $(field_id_name).append(
    `
    <%= render "messages/message", message: @message unless @message.blank? %>

    `
  );

  var ids_of_children = "<%= @message.children.pluck(:id) %>";

  setTimeout(
  function()
  {

    $.each(JSON.parse(ids_of_children), function(index, value){
    	get_message(value, index * 1000);
    });


  }, 1000);

  function get_message(id, timeout) {
    setTimeout(
    function()
    {

        $.ajax({
          url: "/vegan_chat/get_message/" + id,
          method: 'POST',
          headers: {
            'X-CSRF-Token': document.querySelector("meta[name=csrf-token]").content
          }
        });


    }, timeout);
  }

  setTimeout(
  function()
  {
    let target_message_id = "<%= @message.target_message_id %>";
    let load_next_message = "<%= (@message.chatter == 'vegan' && Message.where(id: @message.target_message_id).present? && Message.find(@message.target_message_id).chatter == 'vegan').to_s %>";

    //console.log(load_next_message);

    if (load_next_message === "true") {

      $.ajax({
        url: "/vegan_chat/get_message/" + target_message_id,
        method: 'POST',
        headers: {
          'X-CSRF-Token': document.querySelector("meta[name=csrf-token]").content
        }
      });
    }

  }, 2000);
