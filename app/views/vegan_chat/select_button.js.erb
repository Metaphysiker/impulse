var ids_of_buttons = "<%= @message.parent.children.pluck(:id) %>";
var target_message_id = "<%= @target_message.id %>";
var message_id = "<%= @message.id %>";
var parsed_ids_of_buttons = JSON.parse(ids_of_buttons);

function remove_all_buttons(parsed_ids_of_buttons) {
  return new Promise((resolve, reject) => {
    $.each(parsed_ids_of_buttons, function(index, value){
      remove_button(value, 0);
      if(index === parsed_ids_of_buttons.length){
        resolve("SUCCESS");
      }
    });
  })
}

remove_all_buttons(parsed_ids_of_buttons).then(

  setTimeout(function() {
    $.ajax({
      url: "/vegan_chat/get_message/" + message_id,
      method: 'POST',
      headers: {
        'X-CSRF-Token': document.querySelector("meta[name=csrf-token]").content
      }
    })
  }, 1000)
);



//const promise = doSomething();
//promise.then(successCallback, failureCallback);


function remove_button(id, timeout) {
  setTimeout(
  function()
  {

    var button_id = "#chat-select-button-" + id;

    animateCSS(button_id, 'bounce').then((message) => {
      $("#chat-select-button-" + id).remove();
    });

    $("#chat-select-button-" + id).addClass('animate__fadeOut animate__faster');
    //$("#chat-select-button-" + id).fadeOut();
    //$("#chat-field").removeChild("#chat-select-button-" + id);

    //var parentNode = document.getElementById("chat-field");
    //var childNode = document.getElementById("chat-select-button-" + id);
    //parentNode.removeChild(childNode);
  }, timeout);
}

const animateCSS = (element, animation, prefix = 'animate__') =>
  // We create a Promise and return it
  new Promise((resolve, reject) => {
    const animationName = `${prefix}${animation}`;
    const node = document.querySelector(element);

    node.classList.add(`${prefix}animated`, animationName);

    // When the animation ends, we clean the classes and resolve the Promise
    function handleAnimationEnd() {
      node.classList.remove(`${prefix}animated`, animationName);
      node.removeEventListener('animationend', handleAnimationEnd);

      resolve('Animation ended');
    }

    node.addEventListener('animationend', handleAnimationEnd);
  });
