<% month = @date.month %>
<% first_day = @date.beginning_of_month.beginning_of_week %>
<% last_day = @date.end_of_month.end_of_week %>
<% all_month_days = first_day..last_day %>
<% only_month_days = @date.beginning_of_month..@date.end_of_month %>

<!-- Month -->
<div class="container-fluid bg-white">
  <div class="d-none d-md-block">
    <div class="jumbotron bg-white">
      <div class="text-center m-2">

      </div>
      <div class="text-center m-2">
        <%= link_to event_calendar_path(@date - 1.month) do %>
          <div class="btn btn-primary">
            &#8249; &#8249;
          </div>
        <% end %>
        <span class="mx-3">
          <b><%= I18n.t("date.month_names")[month] %></b>
        </span>
        <%= link_to event_calendar_path(@date + 1.month) do %>
          <div class="btn btn-primary">
            &#8250; &#8250;
          </div>
        <% end %>
      </div>
      <table class="table table-bordered rounded">
      <thead>
        <tr>
          <th class="text-center small-text">Montag</th>
          <th class="text-center small-text">Dienstag</th>
          <th class="text-center small-text">Mittwoch</th>
          <th class="text-center small-text">Donnerstag</th>
          <th class="text-center small-text">Freitag</th>
          <th class="text-center small-text">Samstag</th>
          <th class="text-center small-text">Sonntag</th>
        </tr>
      </thead>
      <tbody>
        <% all_month_days.to_a.in_groups_of(7).each do |week| %>
          <tr style="height: 150px;">
            <% week.each do |day| %>
            <% backgroundcolorforday = "bg-lightgray" unless day.between?(@date.beginning_of_month, @date.end_of_month) %>
            <% backgroundcolorforday = "bg-lightcyan" if day === Date.today %>
            <td class="day-td <%= day.strftime("%d-%m-%Y") %> <%= backgroundcolorforday %>" style="width: 14.28%;">
              <%= render "event_calendar/day-lg", day: day, events: @events %>
            </td>
            <% end %>
          </tr>
        <% end %>

      </tbody>
    </table>
    </div>
  </div>

  <div class="">
    <div class="text-center m-2">
      <%= link_to event_calendar_path(@date - 1.month) do %>
        <div class="btn btn-primary">
          &#8249; &#8249;
        </div>
      <% end %>
      <span class="mx-3">
        <b><%= I18n.t("date.month_names")[month] %></b>
      </span>
      <%= link_to event_calendar_path(@date + 1.month) do %>
        <div class="btn btn-primary">
          &#8250; &#8250;
        </div>
      <% end %>
    </div>
      <% @events.each do |event| %>
      <div class="card mb-3">
        <div class="row no-gutters">
          <div class="col-3 col-md-4 ">
            <% if event.cover.attached? %>
              <%= link_to event_path(event), class: "text-dark" do %>
                <%= image_tag event.cover, class: "card-img" %>
              <% end %>
            <% end %>
          </div>
          <div class="col-2 d-flex justify-content-center align-items-center">
            <p class="lead">
              <%= l(event.start_of_date, format: "%-d %b") %>
            </p>
          </div>
          <div class="d-none d-md-block col-md-6">
            <div class="card-body">

              <h5 class="card-title"><%= link_to event.title, event_path(event), class: "text-dark" %></h5>
              <p class="card-text"><%= event.description.truncate(75) %></p>
              <p class="card-text"><%= link_to "Mehr erfarhen!", event_path(event) %></p>
            </div>
          </div>
          <div class="d-md-none col-7">
            <div class="card-body small">
              <h5 class="card-title"><%= link_to event.title, event_path(event), class: "text-dark" %></h5>
            </div>
          </div>
        </div>
        </div>
      <% end %>

  </div>

<!-- Day-view -->
  <div class="d-md-none">
    <div class="jumbotron bg-white">
      <div class="text-center m-2">

      </div>
      <div class="text-center m-2">
        <%= link_to event_calendar_path(@date - 1.month) do %>
          <div class="btn btn-primary">
            &#8249; &#8249;
          </div>
        <% end %>
        <span class="mx-3">
          <b><%= I18n.t("date.month_names")[month] %></b>
        </span>
        <%= link_to event_calendar_path(@date + 1.month) do %>
          <div class="btn btn-primary">
            &#8250; &#8250;
          </div>
        <% end %>
      </div>
      <% only_month_days.to_a.each do |day| %>
      <div class="my-3 text-center rounded border">
        <%= render "event_calendar/day-lg", day: day, events: @events %>
      </div>
      <% end %>
    </div>
  </div>
</div>
